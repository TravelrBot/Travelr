import {Transit} from './transit';

let body: Transit.IAllTransitInfo = {
   "geocoded_waypoints" : [
      {
         "geocoder_status" : "OK",
         "place_id" : "EjIyMzAxLTIzOTkgQ2Fyb2wgR29vZCBMbiwgQ2Fycm9sbHRvbiwgVFggNzUwMDYsIFVTQQ",
         "types" : [ "street_address" ]
      },
      {
         "geocoder_status" : "OK",
         "place_id" : "ChIJET65KGYqTIYRsvc8YUzSUBI",
         "types" : [ "route" ]
      }
   ],
   "routes" : [
      {
         "bounds" : {
            "northeast" : {
               "lat" : 32.9781652,
               "lng" : -96.87729059999999
            },
            "southwest" : {
               "lat" : 32.841282,
               "lng" : -97.03941999999999
            }
         },
         "copyrights" : "Map data Â©2017 Google",
         "legs" : [
            {
               "arrival_time" : {
                  "text" : "12:00pm",
                  "time_zone" : "America/Chicago",
                  "value" : 1495558839
               },
               "departure_time" : {
                  "text" : "10:14am",
                  "time_zone" : "America/Chicago",
                  "value" : 1495552473
               },
               "distance" : {
                  "text" : "25.8 mi",
                  "value" : 41476
               },
               "duration" : {
                  "text" : "1 hour 46 mins",
                  "value" : 6366
               },
               "end_address" : "N Service Rd, Grapevine, TX 76051, USA",
               "end_location" : {
                  "lat" : 32.89980190000001,
                  "lng" : -97.0393806
               },
               "start_address" : "2301-2399 Carol Good Ln, Carrollton, TX 75006, USA",
               "start_location" : {
                  "lat" : 32.9781652,
                  "lng" : -96.885317
               },
               "steps" : [
                  {
                     "distance" : {
                        "text" : "0.5 mi",
                        "value" : 754
                     },
                     "duration" : {
                        "text" : "9 mins",
                        "value" : 556
                     },
                     "end_location" : {
                        "lat" : 32.975316,
                        "lng" : -96.88998099999999
                     },
                     "html_instructions" : "Walk to Josey @ Jackson - S - FS",
                     "polyline" : {
                        "points" : "q`hhEf|inQbB@B?D?@@@@@B@D?D?|@pB@ExX@P@NlAK~AG^?VAx@?r@@?D"
                     },
                     "start_location" : {
                        "lat" : 32.9781652,
                        "lng" : -96.885317
                     },
                     "steps" : [
                        {
                           "distance" : {
                              "text" : "328 ft",
                              "value" : 100
                           },
                           "duration" : {
                              "text" : "1 min",
                              "value" : 75
                           },
                           "end_location" : {
                              "lat" : 32.977584,
                              "lng" : -96.88573699999999
                           },
                           "html_instructions" : "Head \u003cb\u003esouth\u003c/b\u003e on \u003cb\u003eCarol Good Ln\u003c/b\u003e toward \u003cb\u003eClubview Dr\u003c/b\u003e",
                           "polyline" : {
                              "points" : "q`hhEf|inQbB@B?D?@@@@@B@D?D?|@"
                           },
                           "start_location" : {
                              "lat" : 32.9781652,
                              "lng" : -96.885317
                           },
                           "travel_mode" : "WALKING"
                        },
                        {
                           "distance" : {
                              "text" : "207 ft",
                              "value" : 63
                           },
                           "duration" : {
                              "text" : "1 min",
                              "value" : 46
                           },
                           "end_location" : {
                              "lat" : 32.9770145,
                              "lng" : -96.88574729999999
                           },
                           "html_instructions" : "Turn \u003cb\u003eleft\u003c/b\u003e onto \u003cb\u003eClubview Dr\u003c/b\u003e",
                           "maneuver" : "turn-left",
                           "polyline" : {
                              "points" : "{|ghEz~inQpB@"
                           },
                           "start_location" : {
                              "lat" : 32.977584,
                              "lng" : -96.88573699999999
                           },
                           "travel_mode" : "WALKING"
                        },
                        {
                           "distance" : {
                              "text" : "0.2 mi",
                              "value" : 401
                           },
                           "duration" : {
                              "text" : "5 mins",
                              "value" : 305
                           },
                           "end_location" : {
                              "lat" : 32.9770214,
                              "lng" : -96.8900479
                           },
                           "html_instructions" : "Turn \u003cb\u003eright\u003c/b\u003e onto \u003cb\u003eJamestown Ln\u003c/b\u003e",
                           "maneuver" : "turn-right",
                           "polyline" : {
                              "points" : "iyghE|~inQExX@P@N"
                           },
                           "start_location" : {
                              "lat" : 32.9770145,
                              "lng" : -96.88574729999999
                           },
                           "travel_mode" : "WALKING"
                        },
                        {
                           "distance" : {
                              "text" : "0.1 mi",
                              "value" : 190
                           },
                           "duration" : {
                              "text" : "2 mins",
                              "value" : 130
                           },
                           "end_location" : {
                              "lat" : 32.975316,
                              "lng" : -96.88998099999999
                           },
                           "html_instructions" : "Turn \u003cb\u003eleft\u003c/b\u003e onto \u003cb\u003eN Josey Ln\u003c/b\u003e\u003cdiv style=\"font-size:0.9em\"\u003eDestination will be on the right\u003c/div\u003e",
                           "maneuver" : "turn-left",
                           "polyline" : {
                              "points" : "kyghExyjnQlAK~AG^?VAx@?r@@?D"
                           },
                           "start_location" : {
                              "lat" : 32.9770214,
                              "lng" : -96.8900479
                           },
                           "travel_mode" : "WALKING"
                        }
                     ],
                     "travel_mode" : "WALKING"
                  },
                  {
                     "distance" : {
                        "text" : "5.0 mi",
                        "value" : 8075
                     },
                     "duration" : {
                        "text" : "17 mins",
                        "value" : 1005
                     },
                     "end_location" : {
                        "lat" : 32.921989,
                        "lng" : -96.896417
                     },
                     "html_instructions" : "Bus towards 531 Farmers Branch Station",
                     "polyline" : {
                        "points" : "wnghEjyjnQ?I~A@L?b@?rCDn@@ZBlA?b@?n@?vE?bA@nB@V?rBF`@@XBtBBrBBfE?`A?hE?d@?pD?|A?X?Z@T@F?XBd@AZ?rA?D?dB@f@@tBAZ?dB?nA?f@@rDAvDB~@@rB@fBBV?~F@p@?~EDdB@dBFT?dBBNAx@?nD@jA?fB?lDAlCBn@@zB@bA@`B@`D?`BDx@?jA@fD?pC@|A@zA?tDHH?|CBZ?rB?v@@p@@fB@L?N?h@@P?\\@n@@X@dA@L?L?zCF~C?x@?@?VAH?@?x@IZI@?b@Q@?z@c@VQDEJKFGFIBAf@w@jBsCpB{Cf@w@fAcBfBuClBoClBqCd@w@`A{AjByCjBqCj@y@~@uAh@m@\\[l@Y^M\\GVAr@?rA@b@@bA@V?xFDjFD?vA?`@C~D?rBApB?xBAbD?pA?@?^B\\?@Fn@Ff@H^Rx@X|AF`@Db@Bf@@p@?v@@r@@Z@t@BvD?t@BrD@nB@dE?N?`A@bE@xFDjD?DBRL~@Hd@Pt@LCHAxEgALCb@InE}@|A]_@wCM?SEyDz@@L"
                     },
                     "start_location" : {
                        "lat" : 32.975316,
                        "lng" : -96.88998099999999
                     },
                     "transit_details" : {
                        "arrival_stop" : {
                           "location" : {
                              "lat" : 32.921989,
                              "lng" : -96.896417
                           },
                           "name" : "Farmers Branch Station"
                        },
                        "arrival_time" : {
                           "text" : "10:40am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495554000
                        },
                        "departure_stop" : {
                           "location" : {
                              "lat" : 32.975316,
                              "lng" : -96.88998099999999
                           },
                           "name" : "Josey @ Jackson - S - FS"
                        },
                        "departure_time" : {
                           "text" : "10:23am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495552995
                        },
                        "headsign" : "531 Farmers Branch Station",
                        "line" : {
                           "agencies" : [
                              {
                                 "name" : "DALLAS AREA RAPID TRANSIT",
                                 "url" : "http://www.dart.org/"
                              }
                           ],
                           "color" : "#6a1b9a",
                           "name" : "Baylor Medical/Farmers Branch STA.",
                           "short_name" : "531",
                           "text_color" : "#ffffff",
                           "vehicle" : {
                              "icon" : "//maps.gstatic.com/mapfiles/transit/iw2/6/bus2.png",
                              "name" : "Bus",
                              "type" : "BUS"
                           }
                        },
                        "num_stops" : 28
                     },
                     "travel_mode" : "TRANSIT"
                  },
                  {
                     "distance" : {
                        "text" : "4.9 mi",
                        "value" : 7861
                     },
                     "duration" : {
                        "text" : "11 mins",
                        "value" : 630
                     },
                     "end_location" : {
                        "lat" : 32.853597,
                        "lng" : -96.87749199999999
                     },
                     "html_instructions" : "Light rail towards S - Green Line - Buckner",
                     "polyline" : {
                        "points" : "ma}gEralnQE[pIgBdNwChj@oLjSkEbWqFhRaExMsCtMsCtCm@hJqBhPkDjJoBhNyCrH_BrOgDx@O`Dq@lJqBzG{ArFiA~PuD`ToE|McCfFm@lJaA|BYjEa@vDc@vD_@B?lAMVC\\?l@Pv@^l@HtRsBfJq@tHoADf@"
                     },
                     "start_location" : {
                        "lat" : 32.921989,
                        "lng" : -96.896417
                     },
                     "transit_details" : {
                        "arrival_stop" : {
                           "location" : {
                              "lat" : 32.853597,
                              "lng" : -96.87749199999999
                           },
                           "name" : "Bachman Station"
                        },
                        "arrival_time" : {
                           "text" : "11:10am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495555800
                        },
                        "departure_stop" : {
                           "location" : {
                              "lat" : 32.921989,
                              "lng" : -96.896417
                           },
                           "name" : "Farmers Branch Station"
                        },
                        "departure_time" : {
                           "text" : "10:59am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495555170
                        },
                        "headsign" : "S - Green Line - Buckner",
                        "line" : {
                           "agencies" : [
                              {
                                 "name" : "DALLAS AREA RAPID TRANSIT",
                                 "url" : "http://www.dart.org/"
                              }
                           ],
                           "color" : "#00873f",
                           "name" : "Dart Light Rail - Green Line",
                           "short_name" : "GREEN",
                           "text_color" : "#ffffff",
                           "vehicle" : {
                              "icon" : "//maps.gstatic.com/mapfiles/transit/iw2/6/tram2.png",
                              "name" : "Light rail",
                              "type" : "TRAM"
                           }
                        },
                        "num_stops" : 3
                     },
                     "travel_mode" : "TRANSIT"
                  },
                  {
                     "distance" : {
                        "text" : "14.9 mi",
                        "value" : 23984
                     },
                     "duration" : {
                        "text" : "31 mins",
                        "value" : 1860
                     },
                     "end_location" : {
                        "lat" : 32.90701,
                        "lng" : -97.03941999999999
                     },
                     "html_instructions" : "Light rail towards W - Orange Line - DFW",
                     "polyline" : {
                        "points" : "_vogEhkhnQEg@uHnAgJp@_BfBo@`BWzD^|CbArFjAjDhDhEpD`D~CzC~EnFbF|FbBhBfDvFfIxNpJxPhJ|N~GlJrKdP`B`Dj@~CHnDMnCw@rDmCfEiFrEsKrKsHnJyEhHkEtHeAhC{@rBgC`HeBjFmG~MyBhE{BxCyAxCgDbI_BrBuAr@qBLoGB}C^qDpAaIvEk@Hy@?iBa@aDm@aCj@eLjFYNoQrS_DzCKD}DzB[XuAf@aBLmBF_A\\}EzA}Ar@oAt@oApAgArAcCbEqHvMgFdJiCdGsB|FkCbKaC~J}DzOe@xEHvGBfPJvB|@rBhAt@rAXdBTnBLhGb@rCh@fB|@hA|AjBhDdDlIdAfD\\bE?vME~GQfV?|Sa@lDg@hB_BjCyA`BsAt@qD`BuElBkGxB_GdCgHnD}CpCwEhGmDtF{FrJmCjFQ^eHlMaIbJwEhEkD~CsgBbkB}@bAoz@f`A_h@br@_CvDuBdDkAnBeA~Bw@dB}@rCi@bC]fCOvC?xCJpB`@rBl@pBl@|@x@r@|@`@dAPlBPbHX~jBSvE`D"
                     },
                     "start_location" : {
                        "lat" : 32.853597,
                        "lng" : -96.87749199999999
                     },
                     "transit_details" : {
                        "arrival_stop" : {
                           "location" : {
                              "lat" : 32.90701,
                              "lng" : -97.03941999999999
                           },
                           "name" : "DFW Airport Station"
                        },
                        "arrival_time" : {
                           "text" : "11:51am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495558260
                        },
                        "departure_stop" : {
                           "location" : {
                              "lat" : 32.853597,
                              "lng" : -96.87749199999999
                           },
                           "name" : "Bachman Station"
                        },
                        "departure_time" : {
                           "text" : "11:20am",
                           "time_zone" : "America/Chicago",
                           "value" : 1495556400
                        },
                        "headsign" : "W - Orange Line - DFW",
                        "line" : {
                           "agencies" : [
                              {
                                 "name" : "DALLAS AREA RAPID TRANSIT",
                                 "url" : "http://www.dart.org/"
                              }
                           ],
                           "color" : "#cc6600",
                           "name" : "Dart Light Rail - Orange Line",
                           "short_name" : "ORANGE",
                           "text_color" : "#ffffff",
                           "vehicle" : {
                              "icon" : "//maps.gstatic.com/mapfiles/transit/iw2/6/tram2.png",
                              "name" : "Light rail",
                              "type" : "TRAM"
                           }
                        },
                        "num_stops" : 6
                     },
                     "travel_mode" : "TRANSIT"
                  },
                  {
                     "distance" : {
                        "text" : "0.5 mi",
                        "value" : 802
                     },
                     "duration" : {
                        "text" : "10 mins",
                        "value" : 578
                     },
                     "end_location" : {
                        "lat" : 32.89980190000001,
                        "lng" : -97.0393806
                     },
                     "html_instructions" : "Walk to N Service Rd, Grapevine, TX 76051, USA",
                     "polyline" : {
                        "points" : "yczgEj_hoQ?Qb@AfB@tA@tB?`B?@?B?d@?D?@?|@?nB@B?B?v@@D?rD?dEAN?@?V?Z?J?rFD"
                     },
                     "start_location" : {
                        "lat" : 32.90701,
                        "lng" : -97.03941999999999
                     },
                     "steps" : [
                        {
                           "distance" : {
                              "text" : "0.5 mi",
                              "value" : 802
                           },
                           "duration" : {
                              "text" : "10 mins",
                              "value" : 578
                           },
                           "end_location" : {
                              "lat" : 32.89980190000001,
                              "lng" : -97.0393806
                           },
                           "html_instructions" : "Head \u003cb\u003esouth\u003c/b\u003e on \u003cb\u003eN Service Rd\u003c/b\u003e\u003cdiv style=\"font-size:0.9em\"\u003eDestination will be on the right\u003c/div\u003e",
                           "polyline" : {
                              "points" : "yczgEj_hoQ?Qb@AfB@tA@tB?`B?@?B?d@?D?@?|@?nB@B?B?v@@D?rD?dEAN?@?V?Z?J?rFD"
                           },
                           "start_location" : {
                              "lat" : 32.90701,
                              "lng" : -97.03941999999999
                           },
                           "travel_mode" : "WALKING"
                        }
                     ],
                     "travel_mode" : "WALKING"
                  }
               ],
               "traffic_speed_entry" : [],
               "via_waypoint" : []
            }
         ],
         "overview_polyline" : {
            "points" : "q`hhEf|inQnBBDP?|@pB@CjY@NlAK~BGpAAr@@?D?I~A@p@?lHJnJ@fC@tCHnCFzHBbN?vB?p@BbB@fFBfIAzE?vFDrNFpGDjEHdE@pO?|JHbG@zCDbNDpGHfDBxFBnDBvJNrFAJ?x@IZId@Q|@c@p@k@~CwExCsEnDyFzEaHfBsCbI{LfAiAlAg@t@IfC@xJHjFD?vAC`FCbO?rAB|@Fp@PfAl@vCLdAFdEF~HFxN@dGFdLBXVdBPt@LCbFiAp@MlH{A_@wCM?SEyDz@@LE[vX_GbjBo`@bbB}]|a@{InOeD`f@eK|McCfFm@jN{A~PeBdBQ\\?l@Pv@^l@HtRsBfJq@tHoADf@Eg@uHnAgJp@_BfBo@`BWzD^|CbArFjAjDhDhEpD`D~CzC~EnFbF|FbBhBfDvFxTr`@hJ|N~GlJrKdP`B`Dj@~CHnDMnCw@rDmCfEiFrEsKrKsHnJyEhHkEtHaC|FmFlOmG~MyBhE{BxCyAxCgDbI_BrBuAr@qBLoGB}C^qDpAaIvEk@Hy@?kGoAaCj@eLjFYNoQrSkD`D}DzB[XuAf@aBLmBF_A\\}EzA}Ar@oAt@oApAgArAcCbEyO|XiCdGsB|FkCbKaC~J}DzOe@xEHvGBfPJvB|@rBhAt@rAXdBTnBLhGb@rCh@fB|@hA|AjBhDdDlIdAfD\\bE?vME~GQfV?|Sa@lDg@hB_BjCyA`BsAt@qD`BuElBkGxB_GdCgHnD}CpCwEhGmDtF{FrJ_DjGeHlMaIbJcKhJqiBfmBoz@f`A_h@br@uF|IkAnBeA~Bw@dB}@rCi@bC]fCOvC?xCJpB`@rBl@pBl@|@x@r@|@`@dAPlBPbHX~jBSvE`D?QjC?nH@bF@lM?rHD"
         },
         "summary" : "",
         "warnings" : [
            "Walking directions are in beta.    Use caution â This route may be missing sidewalks or pedestrian paths."
         ],
         "waypoint_order" : []
      }
   ],
   "status" : "OK"
};

function HtmlParse (html: string): string 
{
    html += " ";
    let html_array: string[] = html.split("");
    let html_return: string = '';

    // loop through each word 
    for (let i: number = 0; i < html_array.length; i+= 1)
    {
        if (html_array[i] == "<")
        {
            while (html_array[i] != '>' || html_array[i+1] == "<")
            {
                i++;
            }

            i++
        }

        html_return += html_array[i];
    }

    return (html_return.replace(/  /g, " ").trim())
}

// Create an array to hold all of the transit options
// Right now there is only 1 options we are giving
let transitOptions: Transit.IFinalLegInfo;

// Get the results
for (let route_step: number = 0; route_step < body.routes.length; route_step++)
{
    // Right now there is only 1 route
    let legs: Transit.ILeg[] = body.routes[route_step].legs;

    // loop through each leg
    // Right now there is only 1 leg because there are no waypoints
    legs.forEach(leg => 
    {       
            let transitLegInfo: Transit.IFinalLegInfo = 
            {
                transitArrivalTime: leg.arrival_time.text,
                transitDepartureTime: leg.departure_time.text,
                transitDistance: leg.distance.text,
                transitDuration: leg.duration.text,
                transitSteps: [],
            };


            // There are many steps
            let steps: Transit.IStep[] = leg.steps

            steps.forEach(step => 
            {
                if (step.travel_mode == "WALKING")
                {
                    let walkingStepInfo: Transit.IStepWalkingInfo = 
                    {
                        stepDistance: step.distance.text,
                        stepDuration: step.duration.text,
                        stepMainInstruction: step.html_instructions,
                        stepTransitMode: step.travel_mode,
                        stepDeatiledInstructions: []
                    };

                    step.steps.forEach(detailedStep => 
                    {
                        let detailedStepInfo: Transit.IStepDetailedWalkingInfo =
                        {
                            stepDistance: detailedStep.distance.text,
                            stepDuration: detailedStep.duration.text,
                            stepMainInstruction: HtmlParse(detailedStep.html_instructions),
                            stepTransitMode: detailedStep.travel_mode
                        };

                        // Add to Main step deailted instruction array 
                        walkingStepInfo.stepDeatiledInstructions.push(detailedStepInfo);
                    });
                    
                    // Add the step and instruction to the main leg info
                    transitLegInfo.transitSteps.push(walkingStepInfo);
                }

                else //( step.travel_mode == "TRANSIT")
                {
                    let transitStepInfo: Transit.IStepTransitInfo =
                    {
                        stepDistance: step.distance.text,
                        stepDuration: step.duration.text,
                        stepMainInstruction: step.html_instructions,
                        stepTransitMode: step.travel_mode,
                        arrivalStopName: step.transit_details.arrival_stop.name,
                        arrivalStopTime: step.transit_details.arrival_time.text,
                        departureStopName: step.transit_details.departure_stop.name,
                        departureStopTime: step.transit_details.departure_time.text,
                        numberOfStop: step.transit_details.num_stops,
                        vehicleName: step.transit_details.headsign,
                        vehicleType: step.transit_details.line.vehicle.type
                    }

                    // Push to steps
                    transitLegInfo.transitSteps.push(transitStepInfo);
                }
 
            });

            console.log(transitLegInfo);
    });

}